<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Socento Social{% endblock %}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>

</head>

<body data-username="{{ current_user.username if current_user.is_authenticated else '' }}">
    <div id="preloader">
        <i class="fa-solid fa-dna preloader-icon"></i>
    </div>
    {% if current_user.is_authenticated %}
    <div class="mobile-bottom-nav">
        <a href="#" class="nav-item" data-feed="posts"><i class="fas fa-home"></i><span>Ana Sayfa</span></a>
        <a href="#" class="nav-item" data-feed="echoes"><i class="fas fa-microphone-lines"></i><span>Echoes</span></a>
        <a href="{{ url_for('new_post') }}" class="nav-item new-post-button"><i class="fas fa-plus-circle"></i></a>
        <a href="{{ url_for('create_blink') }}" class="nav-item"><i class="fas fa-magic"></i><span>Blink Oluştur</span></a>
        <a href="#" class="nav-item" data-feed="clips"><i class="fas fa-film"></i><span>Clips</span></a>
        <a href="{{ url_for('upgrade_plan') }}" class="nav-item"><i class="fas fa-gem"></i><span>Premium</span></a>
        <a href="{{ url_for('profile', username=current_user.username) }}" class="nav-item profile-nav-item"><img
                src="{{ url_for('static', filename='uploads/profile_pics/' + current_user.profile_image) }}"
                alt="Profil"></a>
    </div>
    {% endif %}


    <div id="main-content">
        <nav>
            <div class="nav-container">
                <a href="{{ url_for('home') }}" class="nav-brand">Socento</a>
                <form class="search-form" action="{{ url_for('search') }}" method="GET">
                    <input type="text" name="query" placeholder="Kullanıcı veya gönderi ara..." class="search-input">
                    <button type="submit" class="search-button"><i class="fas fa-search"></i></button>
                </form>
                <ul class="nav-links" id="nav-links-desktop">
                    {% if current_user.is_authenticated %}
                    <li><a href="#" class="main-nav-link" data-feed="posts"><i class="fas fa-home"></i><span></span></a>
                    </li>
                    <li><a href="#" class="main-nav-link" data-feed="echoes"><i
                                class="fas fa-microphone-lines"></i><span> Echoes</span></a></li>
                    <li><a href="#" class="main-nav-link" data-feed="clips"><i class="fas fa-film"></i><span>
                                Clips</span></a></li>

                    {% if is_premium %}
                    <li><a href="{{ url_for('inner_network_home') }}"><i class="fas fa-gem"></i> InnerNetwork</a></li>
                    <li><a href="{{ url_for('premium_communities') }}"><i class="fas fa-people-group"></i>
                            Topluluklar</a></li>

                    {% if is_infinity and infinity_network %}
                    <li><a href="{{ url_for('my_network_slug', slug=infinity_network.slug) }}"><i
                                class="fa-solid fa-user-astronaut"></i> Ağım</a></li>
                    {% elif is_infinity %}
                    <li><a href="{{ url_for('create_network') }}"><i class="fa-solid fa-user-astronaut"></i> Ağım</a>
                    </li>
                    {% endif %}

                    {% if membered_networks %}
                    <li class="nav-item-dropdown">
                        <a href="#" class="nav-link-dropdown-toggle"><i class="fas fa-network-wired"></i> Üye
                            Ağlarım</a>
                        <div class="dropdown-menu">
                            {% for network in membered_networks %}
                            <a href="{{ url_for('my_network_slug', slug=network.slug) }}" class="dropdown-item">{{
                                network.name }}</a>
                            {% endfor %}
                        </div>
                    </li>
                    {% endif %}

                    {% else %}
                    <li><a href="{{ url_for('upgrade_plan') }}"><i class="fas fa-gem"></i> Premium</a></li>
                    {% endif %}
                    <li><a href="{{ url_for('notifications') }}">
                            <i class="fas fa-bell">
                                {% if unread_notifications_count > 0 %}
                            </i><span class="notification-badge">{{ unread_notifications_count }}</span>
                            {% endif %}
                            </i>
                        </a></li>
                    <li><a href="{{ url_for('new_post') }}" class="navbar-btn navbar-new-post-btn"><i
                                class="fas fa-plus"></i></a></li>
                    <li><a href="{{ url_for('create_blink') }}" class="navbar-btn navbar-new-post-btn"><i class="fas fa-plus"></i> Blink</a></li>
                    <li><a href="{{ url_for('profile', username=current_user.username) }}"><i
                                class="fa-regular fa-user"></i></a></li>
                    <li><a href="{{ url_for('logout') }}"><i class="fa-solid fa-right-from-bracket"></i></a></li>
                    {% else %}
                    <li><a href="{{ url_for('login') }}" class="navbar-btn">Giriş Yap</a></li>
                    <li><a href="{{ url_for('register') }}" class="navbar-btn register-btn">Kaydol</a></li>
                    {% endif %}
                </ul>
                <button class="menu-icon" id="mobile-menu-toggle" title="Menü"><i class="fas fa-bars"></i></button>
            </div>
        </nav>

        <ul class="nav-links" id="nav-links-mobile" style="display: none;">
            <li><a href="{{ url_for('communities') }}"><i class="fas fa-people-group"></i> Topluluklar</a></li>
        </ul>


        <div class="main-content-wrapper">
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            <div id="sticky-flash-overlay">
                {% for category, message in messages %}
                <div class="sticky-flash-message alert-{{ category }}">
                    <span class="sticky-flash-text">{{ message }}</span>
                    <button class="sticky-flash-close" aria-label="Kapat">&times;</button>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% endwith %}
            {% block content %}{% endblock %}
        </div>

    </div>

    <style>
        #sticky-flash-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        .sticky-flash-message {
            min-width: 320px;
            max-width: 90vw;
            background: rgba(34, 40, 49, 0.98);
            color: #fff;
            border-radius: 18px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
            padding: 1.2rem 2.5rem 1.2rem 1.5rem;
            font-size: 1.15rem;
            font-weight: 500;
            text-align: center;
            position: relative;
            margin: 0 1rem;
            opacity: 0;
            transform: translateY(-30px) scale(0.98);
            transition: opacity 0.4s, transform 0.4s;
            pointer-events: auto;
            display: flex;
            align-items: center;
            gap: 1.2rem;
        }

        .sticky-flash-message.show {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .sticky-flash-message.alert-success {
            background: linear-gradient(90deg, #10B981 60%, #059669 100%);
            color: #fff;
        }

        .sticky-flash-message.alert-info {
            background: linear-gradient(90deg, #2563eb 60%, #1e40af 100%);
            color: #fff;
        }

        .sticky-flash-message.alert-warning {
            background: linear-gradient(90deg, #f59e42 60%, #fbbf24 100%);
            color: #23272f;
        }

        .sticky-flash-message.alert-danger,
        .sticky-flash-message.alert-error {
            background: linear-gradient(90deg, #ef4444 60%, #b91c1c 100%);
            color: #fff;
        }

        .sticky-flash-close {
            background: none;
            border: none;
            color: inherit;
            font-size: 1.5rem;
            font-weight: bold;
            position: absolute;
            top: 0.7rem;
            right: 1.2rem;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
            pointer-events: auto;
        }

        .sticky-flash-close:hover {
            opacity: 1;
        }

        @media (max-width: 600px) {
            .sticky-flash-message {
                min-width: 0;
                font-size: 1rem;
                padding: 1rem 1.5rem 1rem 1rem;
            }
        }
    </style>
    <script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const overlay = document.getElementById('sticky-flash-overlay');
            if (!overlay) return;
            const messages = overlay.querySelectorAll('.sticky-flash-message');
            messages.forEach((msg, i) => {
                setTimeout(() => {
                    msg.classList.add('show');
                    // Otomatik kaybolma
                    const timeout = setTimeout(() => {
                        msg.classList.remove('show');
                        setTimeout(() => { msg.remove(); if (!overlay.querySelector('.sticky-flash-message')) overlay.remove(); }, 400);
                    }, 3500 + i * 500);
                    // Manuel kapama
                    const closeBtn = msg.querySelector('.sticky-flash-close');
                    if (closeBtn) {
                        closeBtn.onclick = () => {
                            clearTimeout(timeout);
                            msg.classList.remove('show');
                            setTimeout(() => { msg.remove(); if (!overlay.querySelector('.sticky-flash-message')) overlay.remove(); }, 400);
                        };
                    }
                }, 100 + i * 200);
            });
        });
    </script>
    {% block extra_js %}{% endblock %} {# Sayfaya özel JS kodları buraya gelecek #}
</body>

</html>